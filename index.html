<!-- å°‡åŸå§‹ç¢¼æ”¹ç‚ºçƒè–©å¥‡é¢¨æ ¼ç‰ˆæœ¬ï¼ˆæº«æš–æ·ºé»ƒè‰²åº•ï¼‰ -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å…”å“¥å¤©æ°£</title>
<link rel="icon" type="image/png" href="./icon-v2.png">
<link rel="apple-touch-icon" href="./icon-v2.png">
<link rel="apple-touch-icon" sizes="180x180" href="./icon-v2.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --usa-yellow: #FFF5D6;
  --usa-pink: #F8C8D8;
  --usa-brown: #7A5A48;
  --usa-white: #FFFFFF;
  --usa-shadow: rgba(0,0,0,0.1);
  --usa-border: #FFE9B8;
}

body {
  font-family: 'Zen Maru Gothic', sans-serif;
  background-color: var(--usa-yellow);
  background-image: repeating-linear-gradient(45deg, transparent, transparent 25px, rgba(255,255,255,0.25) 25px, rgba(255,255,255,0.25) 50px);
  min-height: 100vh;
  overflow-x: hidden;
  color: var(--usa-brown);
  padding-bottom: 20px;
}

/* é ‚éƒ¨ç‹€æ…‹åˆ— */
.status-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background: rgba(255,255,255,0.4);
  backdrop-filter: blur(10px);
  position: sticky;
  top: 0;
  z-index: 100;
  border-bottom: 3px solid var(--usa-border);
}

.location-pill {
  background: var(--usa-pink);
  color: var(--usa-brown);
  padding: 6px 18px;
  border-radius: 25px;
  font-weight: 900;
  font-size: 1.1rem;
  border: 2px solid white;
  box-shadow: 2px 2px 0 var(--usa-shadow);
}

.update-pill {
  font-size: 0.8rem;
  color: var(--usa-brown);
  background: rgba(255,255,255,0.6);
  padding: 4px 12px;
  border-radius: 12px;
}

.container {
  padding: 20px;
  max-width: 600px;
  margin: 0 auto;
}

/* ä¸»å¡ç‰‡ï¼šçƒè–©å¥‡é¢¨æ ¼åœ“æ½¤ */
.hero-card {
  background: var(--usa-white);
  border-radius: 40px;
  padding: 30px 25px;
  text-align: center;
  border: 4px solid var(--usa-border);
  box-shadow: 0 8px 15px var(--usa-shadow);
  margin-bottom: 25px;
  position: relative;
}

.hero-period {
  position: absolute;
  top: -18px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--usa-pink);
  color: var(--usa-brown);
  padding: 5px 22px;
  border-radius: 18px;
  font-weight: bold;
  border: 3px solid white;
  box-shadow: 0 4px 0 var(--usa-shadow);
}

.hero-temp-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin: 20px 0;
}

.hero-icon {
  font-size: 5rem;
  filter: drop-shadow(0 5px 0 var(--usa-shadow));
  animation: bounce 3s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.hero-temp {
  font-size: 4.5rem;
  font-weight: 900;
  color: var(--usa-brown);
}

.hero-desc {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--usa-brown);
  margin-bottom: 20px;
}

/* å»ºè­°å€ï¼šæ›´åœ“æ›´å¯æ„› */
.advice-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-top: 20px;
  padding-top: 20px;
  border-top: 2px dashed var(--usa-border);
}

.advice-item {
  background: rgba(255,255,255,0.7);
  padding: 12px;
  border-radius: 25px;
  text-align: center;
  border: 2px solid white;
  box-shadow: 0 3px 5px var(--usa-shadow);
}

.advice-icon {
  font-size: 2rem;
}

.advice-text {
  font-size: 1.35rem;
  font-weight: 900;
  color: var(--usa-brown);
  margin: 5px 0;
}

/* æ©«å‘é å ±å¡ç‰‡ */
.section-title {
  font-size: 1.2rem;
  color: var(--usa-brown);
  font-weight: 900;
  margin-bottom: 12px;
  margin-left: 10px;
}

.scroll-container {
  display: flex;
  overflow-x: auto;
  gap: 15px;
  padding-bottom: 10px;
  scrollbar-width: none;
}
.scroll-container::-webkit-scrollbar { display: none; }

.mini-card {
  min-width: 140px;
  background: rgba(255,255,255,0.9);
  border-radius: 25px;
  padding: 18px 15px;
  text-align: center;
  border: 3px solid var(--usa-border);
  flex-shrink: 0;
}

.mini-time {
  background: var(--usa-pink);
  color: var(--usa-brown);
  padding: 4px 10px;
  border-radius: 10px;
  font-size: 0.9rem;
  font-weight: bold;
  margin-bottom: 10px;
}

.mini-icon {
  font-size: 2.4rem;
}

.mini-temp {
  font-size: 1.2rem;
  font-weight: 900;
  color: var(--usa-brown);
}

/* Loading ç•«é¢ */
.loading-screen {
  position: fixed;
  inset: 0;
  background: var(--usa-yellow);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 999;
}
</style>
</head>
<body>
<div id="loading" class="loading-screen">
  <div style="font-size:4rem; animation:bounce 2s infinite;">ğŸ°</div>
  <p style="color:var(--usa-brown); font-weight:bold; margin-top:20px;">çƒè–©å¥‡åŠªåŠ›è§€æ¸¬ä¸­...</p>
</div>

<div class="status-bar">
  <div class="location-pill">ğŸ“ è‡ºå—</div>
  <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
</div>

<div class="container" id="mainContent" style="display:none;">
  <div id="heroCard"></div>

  <h3 class="section-title">ç¨å¾Œé å ±</h3>
  <div class="scroll-container" id="futureForecasts"></div>
</div>

<script>
/* JS åŸç‰ˆä¿ç•™ï¼ˆåƒ…åœ–ç¤ºå¯èª¿æ•´ç‚ºå¯æ„›é¢¨ï¼‰ */
const API_URL = "https://weather-joyce.zeabur.app/api/weather/kaohsiung";

function getWeatherIcon(weather) {
  if (!weather) return "ğŸŒ¤ï¸";
  if (weather.includes("æ™´")) return "ğŸŒ";
  if (weather.includes("å¤šé›²")) return "â˜ï¸";
  if (weather.includes("é™°")) return "ğŸŒ«ï¸";
  if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
  if (weather.includes("é›·")) return "â›ˆï¸";
  return "ğŸŒ¤ï¸";
}

function getAdvice(rainProb, maxTemp) {
  let rainIcon = "ğŸŒ‚";
  let rainText = "ä¸ç”¨å¸¶å‚˜";
  if (parseInt(rainProb) > 30) {
    rainIcon = "â˜‚ï¸";
    rainText = "è¨˜å¾—å¸¶å‚˜ï¼";
  }

  let clothIcon = "ğŸ‘•";
  let clothText = "èˆ’é©ç©¿æ­";
  if (parseInt(maxTemp) >= 28) {
    clothIcon = "ğŸ½";
    clothText = "çŸ­è¢–å‡ºç™¼";
  } else if (parseInt(maxTemp) <= 20) {
    clothIcon = "ğŸ§¥";
    clothText = "åŠ ä»¶å¤–å¥—";
  }

  return { rainIcon, rainText, clothIcon, clothText };
}

function getTimePeriod(startTime) {
  const hour = new Date(startTime).getHours();
  if (hour >= 5 && hour < 11) return "æ—©æ™¨";
  if (hour >= 11 && hour < 14) return "ä¸­åˆ";
  if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
  if (hour >= 18 && hour < 23) return "æ™šä¸Š";
  return "æ·±å¤œ";
}

function renderWeather(data) {
  const forecasts = data.forecasts;
  const current = forecasts[0];
  const others = forecasts.slice(1);

  const advice = getAdvice(current.rain, current.maxTemp);
  const period = getTimePeriod(current.startTime);
  const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

  document.getElementById('heroCard').innerHTML = `
    <div class="hero-card">
      <div class="hero-period">${period}</div>
      <div class="hero-temp-container">
        <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
        <div class="hero-temp">${avgTemp}Â°</div>
      </div>
      <div class="hero-desc">${current.weather}</div>
      <div class="advice-grid">
        <div class="advice-item">
          <div class="advice-icon">${advice.rainIcon}</div>
          <div class="advice-text">${advice.rainText}</div>
          <div style="font-size:0.7rem; color:#999">é™é›¨ç‡ ${current.rain}</div>
        </div>
        <div class="advice-item">
          <div class="advice-icon">${advice.clothIcon}</div>
          <div class="advice-text">${advice.clothText}</div>
          <div style="font-size:0.7rem; color:#999">æœ€é«˜æº« ${current.maxTemp}Â°</div>
        </div>
      </div>
    </div>
  `;

  const scrollContainer = document.getElementById('futureForecasts');
  scrollContainer.innerHTML = '';

  const todayDate = new Date().getDate();

  others.forEach(f => {
    let p = getTimePeriod(f.startTime);
    const fDate = new Date(f.startTime);
    if (fDate.getDate() !== todayDate) {
      p = "æ˜å¤©" + p;
    }

    scrollContainer.innerHTML += `
      <div class="mini-card">
        <div class="mini-time">${p}</div>
        <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
        <div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
        <div style="font-size:0.8rem; color:#888; margin-top:5px;">ğŸ’§${f.rain}</div>
      </div>
    `;
  });

  const now = new Date();
  const month = now.getMonth() + 1;
  const date = now.getDate();
  const days = ["é€±æ—¥","é€±ä¸€","é€±äºŒ","é€±ä¸‰","é€±å››","é€±äº”","é€±å…­"];
  const dayIndex = now.getDay();

  document.getElementById('updateTime').textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
}

async function fetchWeather() {
  try {
    const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
    const fetchPromise = fetch(API_URL).then(res => res.json());

    const [_, json] = await Promise.all([delayPromise, fetchPromise]);

    if (json.success) {
      renderWeather(json.data);
      document.getElementById('loading').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
    } else {
      throw new Error("API Error");
    }
  } catch (e) {
    console.error(e);
    alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼Œçƒè–©å¥‡ç”Ÿæ°£æ°£ï¼");
  }
}

document.addEventListener("DOMContentLoaded", fetchWeather);
</script>
</body>
</html>

